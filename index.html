<!DOCTYPE html>
<html>
<body>

<h3>TTV Google 4</h3>
    
<button onclick="readAloud()">Read Aloud</button>
<button onclick="pauseSpeech()">Pause</button>
<button onclick="resumeSpeech()">Resume</button>
<button onclick="stopSpeech()">Stop</button>

<select id="voiceSelect"></select>

<script>
let voices = [];
let utterance = null;

function loadVoicesProperly() {
    return new Promise(resolve => {
        let tries = 0;

        const check = () => {
            voices = speechSynthesis.getVoices();

            if (voices.length > 0 || tries > 20) {
                resolve(voices);
            } else {
                tries++;
                setTimeout(check, 100);
            }
        };

        check();
    });
}

async function populateVoiceList() {
    await loadVoicesProperly();

    const voiceSelect = document.getElementById("voiceSelect");
    voiceSelect.innerHTML = "";

    // Sort: Google voices first
    const sorted = voices.sort((a, b) => {
        const ag = a.name.toLowerCase().includes("google");
        const bg = b.name.toLowerCase().includes("google");
        return ag === bg ? 0 : ag ? -1 : 1;
    });

    let defaultIndex = 0;

    sorted.forEach((voice, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = `${voice.name} â€” ${voice.lang}`;
        voiceSelect.appendChild(option);

        if (voice.name.toLowerCase().includes("catherine")) {
            defaultIndex = index;
        }
    });

    // If Catherine not found, default to first Google voice
    if (defaultIndex === 0) {
        const googleIndex = sorted.findIndex(v =>
            v.name.toLowerCase().includes("google")
        );
        if (googleIndex !== -1) defaultIndex = googleIndex;
    }

    voiceSelect.value = defaultIndex;
}

speechSynthesis.onvoiceschanged = populateVoiceList;
window.onload = populateVoiceList;
</script>

</body>
</html>
